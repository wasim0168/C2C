<%- include('../../partials/admin-header', { admin }) %>

<div class="container-fluid">
  <div class="row">
    <%- include('../../partials/admin-sidebar') %>

    <main class="col-md-9 ms-sm-auto px-md-4">
      <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2">User Management</h1>
        <div class="btn-toolbar mb-2 mb-md-0">
          <div class="btn-group me-2">
            <button type="button" class="btn btn-sm btn-outline-secondary">Export</button>
          </div>
        </div>
      </div>

      <div class="table-responsive">
        <table class="table table-striped table-hover">
          <thead>
            <tr>
              <th>ID</th>
              <th>Name</th>
              <th>Email</th>
              <th>Products</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
           <% users.forEach(user => { %>
  <tr>
     <td><%= user.id %></td>
    <td><%= user.name %></td>
    <td><%= user.email %></td>
  <td><%= user.product_count %></td>
    <td><%= user.email_verified ? 'Verified' : 'Not Verified' %></td>
    <td>
      <% if (user.is_blocked) { %>
        <span class="badge bg-danger">Blocked</span>
        <small class="text-muted d-block"><%= user.blocked_reason %></small>
      <% } else { %>
        <span class="badge bg-success">Active</span>
      <% } %>
    </td>
    <td>
      

    <a href="/admin/users/<%= user.id %>/products" class="btn btn-sm btn-info">View</a>
    
    <td>
      <% if (user.is_blocked) { %>
        <form action="/admin/users/<%= user.id %>/unblock" method="POST" class="d-inline">
          <button type="submit" class="btn btn-sm btn-success">Unblock</button>
        </form>
      <% } else { %>
        <form action="/admin/users/<%= user.id %>/block" method="POST" class="d-inline">
          <button type="submit" class="btn btn-sm btn-danger">Block</button>
          <input type="text" name="reason" class="form-control form-control-sm d-inline-block w-50 ms-1" 
                 placeholder="Reason" required>
        </form>
      <% } %>
    </td>
  </tr>
<% }) %>
          </tbody>
        </table>
      </div>
    </main>
  </div>
</div>

<%- include('../../partials/admin-footer') %>