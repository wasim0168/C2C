<%- include('../../partials/admin-header', { admin, activePage: 'users' }) %>

<div class="container-fluid">
  <div class="row">
    <%- include('../../partials/admin-sidebar', { activePage: 'users' }) %>

    <main class="col-md-9 ms-sm-auto px-md-4">
      <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2">Products by <%= user.name %></h1>
        <div class="btn-toolbar mb-2 mb-md-0">
          <a href="/admin/users" class="btn btn-sm btn-outline-secondary">
            <i class="bi bi-arrow-left"></i> Back to Users
          </a>
          <a href="mailto:<%= user.email %>" class="btn btn-sm btn-outline-primary ms-2">
            <i class="bi bi-envelope"></i> Contact User
          </a>
        </div>
      </div>

      <% if (products.length === 0) { %>
        <div class="alert alert-info">
          This user hasn't posted any products yet.
        </div>
      <% } else { %>
        <div class="row">
          <% products.forEach(product => { %>
            <div class="col-md-4 mb-4">
              <div class="card h-100">
                <img src="/uploads/<%= product.image %>" class="card-img-top" style="height: 180px; object-fit: cover;">
                <div class="card-body">
                  <h5 class="card-title"><%= product.title %></h5>
                  <p class="card-text"><%= product.description.substring(0, 100) %>...</p>
                  <p class="card-text"><strong>â‚¹<%= product.price %></strong></p>
                  <p class="card-text">
                    <span class="badge bg-primary"><%= product.category %></span>
                    <span class="badge <%= product.is_active ? 'bg-success' : 'bg-danger' %> ms-1">
                      <%= product.is_active ? 'Active' : 'Inactive' %>
                    </span>
                    <% if (!product.is_approved) { %>
                      <span class="badge bg-warning text-dark ms-1">Pending Approval</span>
                    <% } %>
                  </p>
                </div>
                <div class="card-footer bg-white">
                  <a href="/products/<%= product.id %>" class="btn btn-sm btn-outline-primary">View</a>
                  <a href="/admin/products/<%= product.id %>/edit" class="btn btn-sm btn-outline-secondary">Edit</a>
             <form action="/admin/products/<%= product.id %>/toggle-status" method="POST" class="d-inline">
  <button type="submit" class="btn btn-sm <%= product.is_active ? 'btn-outline-danger' : 'btn-outline-success' %>">
    <%= product.is_active ? 'Deactivate' : 'Activate' %>
  </button>
</form>
                </div>
              </div>
            </div>
          <% }) %>
        </div>
      <% } %>
    </main>
  </div>
</div>

<%- include('../../partials/admin-footer') %>